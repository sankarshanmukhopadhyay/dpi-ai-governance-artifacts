{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://example.org/schemas/audit-finding.schema.json",
  "title": "Audit Finding",
  "description": "A structured audit finding for a DPI + AI service, including remediation orders and recurrence tracking.",
  "type": "object",
  "additionalProperties": false,
  "required": ["finding_id", "issued_at", "auditor", "scope", "severity", "finding"],
  "properties": {
    "finding_id": { "type": "string" },
    "issued_at": { "type": "string", "format": "date-time" },
    "auditor": {
      "type": "object",
      "additionalProperties": false,
      "required": ["authority_id"],
      "properties": {
        "authority_id": { "type": "string" },
        "directory_ref": { "type": "string" }
      }
    },
    "scope": {
      "type": "object",
      "additionalProperties": false,
      "required": ["service_id"],
      "properties": {
        "service_id": { "type": "string" },
        "rulebook_refs": { "type": "array", "items": { "type": "string" } },
        "time_window": { "type": "string" }
      }
    },
    "severity": { "type": "string", "enum": ["low", "medium", "high", "critical"] },
    "finding": {
      "type": "object",
      "additionalProperties": false,
      "required": ["summary"],
      "properties": {
        "summary": { "type": "string" },
        "evidence_refs": { "type": "array", "items": { "type": "string" } },
        "affected_receipt_refs": { "type": "array", "items": { "type": "string" } },
        "root_cause": { "type": "string" }
      }
    },
    "remediation": {
      "type": "array",
      "items": {
        "type": "object",
        "additionalProperties": false,
        "required": ["action", "due_by"],
        "properties": {
          "action": { "type": "string" },
          "due_by": { "type": "string", "format": "date" },
          "verification_method": { "type": "string" }
        }
      }
    },
    "signature": {
      "type": "object",
      "additionalProperties": false,
      "required": ["alg", "kid", "value"],
      "properties": {
        "alg": { "type": "string" },
        "kid": { "type": "string" },
        "value": { "type": "string" }
      }
    }
  }
}
